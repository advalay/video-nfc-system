# 🎯 承認ベース組織管理ワークフロー設計

## 📋 概要

非エンジニアでも管理しやすい、構造化された組織登録・承認システム

## 🔄 ワークフロー

### 1️⃣ パートナー企業登録フロー

```
システム管理者 → 企業担当者 → 承認 → アカウント作成
```

**ステップ:**
1. **システム管理者**が企業情報入力フォームを生成
2. **企業担当者**にメールでフォームURL送信
3. **企業担当者**がフォームに情報入力・送信
4. **システム管理者**の承認ダッシュボードに通知
5. **システム管理者**が承認
6. **自動でアカウント作成**・ID/PASSを企業担当者にメール送信
7. **組織一覧に自動追加**

### 2️⃣ 販売店登録フロー

```
パートナー企業 → 販売店担当者 → 承認 → アカウント作成
```

**ステップ:**
1. **パートナー企業管理者**が販売店追加ボタンをクリック
2. **販売店担当者のメールアドレス**を入力
3. **販売店担当者**にメールでフォームURL送信
4. **販売店担当者**がフォームに情報入力・送信
5. **パートナー企業管理者**の承認ダッシュボードに通知
6. **パートナー企業管理者**が承認
7. **自動でアカウント作成**・ID/PASSを販売店担当者にメール送信
8. **パートナー企業配下に販売店が自動追加**

## 🛠 技術実装

### データベース設計

```sql
-- 承認待ち申請テーブル
approval_requests:
- requestId (PK)
- requestType: 'agency' | 'store'
- requesterEmail: 申請者メール
- approverEmail: 承認者メール
- organizationData: JSON (申請データ)
- status: 'pending' | 'approved' | 'rejected'
- createdAt, updatedAt

-- フォーム送信テーブル
form_submissions:
- submissionId (PK)
- requestId (FK)
- formData: JSON (入力データ)
- submittedAt
```

### API エンドポイント

```
POST /api/approval/request          # 承認申請作成
POST /api/approval/submit-form     # フォーム送信
GET  /api/approval/pending         # 承認待ち一覧
POST /api/approval/approve         # 承認
POST /api/approval/reject          # 却下
```

## 📧 メール通知システム

### 1. フォーム送信メール
```
件名: 【動画NFCシステム】組織登録フォーム送信のお知らせ

内容:
- フォームURL
- 入力期限
- 必要事項の説明
```

### 2. 承認通知メール
```
件名: 【動画NFCシステム】組織登録申請の承認待ち

内容:
- 申請内容の要約
- 承認URL
- 却下URL
```

### 3. アカウント作成完了メール
```
件名: 【動画NFCシステム】アカウント作成完了

内容:
- ログインURL
- ユーザーID（メールアドレス）
- 初期パスワード
- 初回ログイン手順
```

## 🎨 UI/UX 設計

### システム管理者画面
- **承認ダッシュボード**: 承認待ち一覧
- **組織一覧**: 既存組織管理
- **申請履歴**: 過去の申請・承認履歴

### パートナー企業管理者画面
- **販売店管理**: 配下販売店一覧
- **販売店追加**: 新規販売店申請
- **承認待ち**: 販売店申請の承認

### 申請者画面（フォーム）
- **シンプルな入力フォーム**
- **必須項目の明確化**
- **入力内容の確認画面**

## 🔐 セキュリティ考慮

1. **フォームURLの有効期限**: 7日間
2. **申請の一意性**: 同じメールアドレスでの重複申請防止
3. **承認権限の分離**: パートナー企業は配下の販売店のみ承認可能
4. **ログ記録**: 全操作の監査ログ

## 📊 管理機能

### ダッシュボード指標
- 承認待ち件数
- 今月の新規登録数
- 申請の処理時間
- 却下率

### レポート機能
- 組織登録履歴
- 承認者別処理状況
- 申請から承認までの時間分析

## 🚀 実装優先順位

### Phase 1: 基本機能
1. 承認申請システム
2. メール通知機能
3. 承認ダッシュボード

### Phase 2: 高度機能
1. 自動アカウント作成
2. 権限管理
3. レポート機能

### Phase 3: 最適化
1. ワークフロー自動化
2. 通知のカスタマイズ
3. モバイル対応

## 💡 非エンジニア向けのメリット

1. **直感的な操作**: ボタンクリックで申請・承認
2. **自動化**: 手動作業の削減
3. **透明性**: 全プロセスの可視化
4. **安全性**: 承認権限の適切な分離
5. **効率性**: メールベースの非同期処理

## 🔧 運用フロー例

### 新規パートナー企業登録
1. システム管理者が「企業登録申請」ボタンをクリック
2. 企業担当者のメールアドレスを入力
3. システムが自動でフォームURLを生成・送信
4. 企業担当者がフォーム入力・送信
5. システム管理者のダッシュボードに通知
6. システム管理者が内容確認・承認
7. 自動でアカウント作成・ID/PASS送信
8. 組織一覧に自動追加

### 販売店追加
1. パートナー企業管理者が「販売店追加」ボタンをクリック
2. 販売店担当者のメールアドレスを入力
3. システムが自動でフォームURLを生成・送信
4. 販売店担当者がフォーム入力・送信
5. パートナー企業管理者のダッシュボードに通知
6. パートナー企業管理者が内容確認・承認
7. 自動でアカウント作成・ID/PASS送信
8. パートナー企業配下に販売店が自動追加

この設計により、非エンジニアでも直感的に組織管理ができ、承認プロセスも透明化されます。





