# NFCタグ付きキーホルダー向け動画配信システム - 管理画面

Next.js 14 (App Router) + AWS Amplify + Tailwind CSSで構築された管理画面です。

## 🚀 セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 環境変数の確認

`.env.local`ファイルに以下が設定されていることを確認してください：

```bash
NEXT_PUBLIC_USER_POOL_ID=ap-northeast-1_gtvMJ70ot
NEXT_PUBLIC_USER_POOL_CLIENT_ID=6o0knadh7s8v164r6a8kvp7m0n
NEXT_PUBLIC_AWS_REGION=ap-northeast-1
NEXT_PUBLIC_API_URL=https://ujwli7k2ti.execute-api.ap-northeast-1.amazonaws.com/dev
NEXT_PUBLIC_CLOUDFRONT_DOMAIN=d1wjaq76zbo052.cloudfront.net
```

### 3. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで http://localhost:3000 にアクセスしてください。

## 🧪 テストアカウント

以下のアカウントでログインできます：

### システム管理者
- **メール**: `system-admin@example.com`
- **パスワード**: `AdminPass123!`
- **権限**: 全代理店・全販売店の動画を閲覧・管理可能

### 代理店A管理者
- **メール**: `org-a-admin@example.com`
- **パスワード**: `OrgAdminPass123!`
- **権限**: 代理店A配下の全販売店（東京・大阪）の動画を閲覧可能

### 東京支店ユーザー
- **メール**: `tokyo-shop@example.com`
- **パスワード**: `ShopPass123!`
- **権限**: 東京支店の動画のみ閲覧・アップロード可能

### 大阪支店ユーザー
- **メール**: `osaka-shop@example.com`
- **パスワード**: `ShopPass123!`
- **権限**: 大阪支店の動画のみ閲覧・アップロード可能

### 代理店B管理者（直接運用）
- **メール**: `org-b-admin@example.com`
- **パスワード**: `OrgAdminPass123!`
- **権限**: 代理店Bの動画を閲覧・アップロード可能

## 📁 プロジェクト構成

```
video-nfc-admin/
├── app/
│   ├── admin/                 # 管理者専用ページ
│   │   ├── analytics/
│   │   │   └── page.tsx       # 代理店分析ページ
│   │   ├── dashboard/
│   │   │   └── page.tsx       # 統計ダッシュボードページ
│   │   └── videos/
│   │       └── page.tsx       # 全動画管理ページ
│   ├── login/
│   │   └── page.tsx           # ログインページ
│   ├── upload/
│   │   └── page.tsx           # 動画アップロードページ
│   ├── videos/
│   │   └── page.tsx           # 動画一覧ページ
│   ├── watch/
│   │   └── [videoId]/
│   │       └── page.tsx       # 動画視聴ページ（公開用）
│   ├── layout.tsx             # ルートレイアウト
│   ├── page.tsx               # ホームページ
│   ├── providers.tsx          # グローバルプロバイダー
│   └── globals.css            # グローバルスタイル
├── components/
│   ├── DateRangePicker.tsx    # 日付範囲選択コンポーネント
│   ├── Layout.tsx             # 共通レイアウトコンポーネント
│   ├── ProtectedRoute.tsx     # 認証保護ルートコンポーネント
│   └── QRModal.tsx            # QRコードモーダルコンポーネント
├── hooks/
│   ├── useAdminStats.ts       # 統計データフック
│   ├── useAllVideos.ts        # 全動画取得フック
│   ├── useAuth.ts             # 認証フック
│   ├── useOrganizations.ts    # 組織管理フック
│   ├── useUpload.ts           # 動画アップロードフック
│   └── useVideos.ts           # 動画管理フック
├── lib/
│   ├── amplify-config.ts      # AWS Amplify設定
│   ├── api.ts                 # API クライアント
│   └── utils.ts               # ユーティリティ関数
├── types/
│   └── index.ts               # TypeScript型定義
├── .env.local                 # 環境変数
└── package.json
```

## 🎨 実装済み機能

### ✅ ログインページ (`/login`)
- 中央配置のカード形式
- メールアドレス + パスワード認証
- パスワード表示/非表示切り替え
- ローディング状態表示
- エラーハンドリング
- トースト通知
- レスポンシブデザイン
- アクセシビリティ対応
- 認証状態チェック（既ログイン時は自動リダイレクト）

### ✅ ホームページ (`/`)
- ユーザー情報表示
- ロール別の表示切り替え
- ログアウト機能
- 認証状態の確認
- クイックアクション（動画一覧、アップロード、請求情報）

### ✅ 動画一覧ページ (`/videos`)
- ヘッダー: ロゴ、ユーザー情報、ログアウトボタン
- 検索バー: ファイル名フィルタ機能
- 統計カード: 総動画数、総容量、アップロード者数
- 動画テーブル: ファイル名、サイズ、アップロード日時、公開URL、アクション
- URLコピー機能: ワンクリックでコピー + トースト通知
- QRコード生成: モーダルで表示、サイズ調整、ダウンロード機能
- 動画削除: 確認ダイアログ付き
- 無限スクロール: 「さらに読み込む」ボタン
- 空状態・ローディング状態・エラー状態の表示
- レスポンシブデザイン

### ✅ 動画アップロードページ (`/upload`)
- ドラッグ&ドロップエリア: 直感的なファイル選択
- ファイル選択ボタン: 従来のファイル選択方式
- バリデーション: MP4形式のみ、50MB以下
- 動画情報入力: タイトル、説明
- プログレスバー: リアルタイムアップロード進捗
- アップロード完了画面: 成功メッセージ、公開URL表示
- URLコピー機能: ワンクリックでコピー + トースト通知
- QRコード表示: モーダルで生成・ダウンロード
- ナビゲーション: ダッシュボード・動画一覧への戻りボタン
- エラーハンドリング: 適切なエラーメッセージ表示
- レスポンシブデザイン

### ✅ 共通コンポーネント
#### Layout コンポーネント
- 統一されたヘッダー: ロゴ、ユーザー情報、ログアウトボタン
- レスポンシブデザイン: モバイル・タブレット・デスクトップ対応
- メインコンテンツエリア: 統一されたコンテナとパディング

#### ProtectedRoute コンポーネント
- 認証状態の自動チェック
- 未ログイン時は自動的に `/login` にリダイレクト
- ローディング中はスピナー表示
- 認証済みユーザーのみコンテンツ表示

#### QRModal コンポーネント
- 300x300pxの大きなQRコード表示
- URL表示とコピー機能
- PNG形式でのダウンロード機能
- ESCキー・オーバーレイクリックで閉じる
- レスポンシブデザイン
- スクロール無効化（モーダル表示時）

## 🔐 認証フロー

1. ユーザーが `/login` でメール・パスワードを入力
2. AWS Cognito User Poolで認証
3. 成功したら `/` にリダイレクト
4. ホームページで認証状態を確認
5. 未認証の場合は `/login` にリダイレクト

## 🛠️ 使用技術

- **Next.js 14**: App Router
- **TypeScript**: 型安全性
- **Tailwind CSS**: スタイリング
- **AWS Amplify**: Cognito認証
- **React Hot Toast**: 通知表示

## 📦 ビルド

### 開発ビルド

```bash
npm run dev
```

### 本番ビルド

```bash
npm run build
npm start
```

### ✅ 統計ダッシュボード (`/admin/dashboard`) 【Phase 3】
システム管理者専用の統計情報画面：
- **サマリーカード**: 総動画数、総容量、代理店数、販売店数、今月のアップロード数
- **月次グラフ**: 過去12ヶ月のアップロード数推移（rechartsで可視化）
- **日付範囲選択**: カスタム期間でデータをフィルタリング
- **数値フォーマット**: 大きな数値を"K"記法で表示（例: 1.5K）
- **レスポンシブグラフ**: モバイルでも見やすいチャート表示

### ✅ 全動画管理 (`/admin/videos`) 【Phase 3】
システム管理者専用の全動画一覧画面：
- **フィルタリング**: 組織別、ステータス別、ファイル名検索
- **詳細表示**: 動画ID、ファイル名、組織名、販売店名、容量、アップロード日
- **URLコピー**: 公開URLをワンクリックでコピー
- **リアルタイム検索**: 入力に応じて即座にフィルタリング
- **統計表示**: 表示中の動画数をリアルタイム表示

### ✅ 代理店分析 (`/admin/analytics`) 【Phase 3】
システム管理者専用の代理店別パフォーマンス分析画面：
- **階層表示**: 代理店カードをクリックで販売店詳細を展開
- **プログレスバー**: 動画数の比率を視覚的に表示（色分けあり）
- **詳細統計**: 各代理店・販売店の動画数、容量、シェア率
- **サマリーカード**: 代理店数、販売店数、総動画数
- **アコーディオンUI**: 展開/折りたたみで見やすく表示
- **カラーコーディング**: 比率に応じた色分け（緑→青→黄→赤）

### ✅ 動画視聴ページ (`/watch/[videoId]`) 【Phase 2】
QRコードからアクセスする公開動画視聴ページ：
- **ビデオプレーヤー**: HTML5 video要素でシームレスな再生
- **ブランディング**: 組織ロゴ・会社名の表示（オプション）
- **自動再生**: QRコードからアクセス時に自動再生開始
- **レスポンシブ**: モバイル最適化されたUI
- **エラーハンドリング**: 動画が見つからない場合の適切な表示

### ✅ 統一ナビゲーション 【Phase 3】
全ページで統一されたヘッダーとメニュー：
- **動的メニュー**: ユーザーの権限に応じてメニュー項目を表示
  - 一般ユーザー: 動画一覧、アップロード
  - システム管理者: 上記 + 統計ダッシュボード、全動画管理、組織管理、代理店分析
- **アクティブ状態**: 現在のページをハイライト表示
- **アイコン付き**: Lucide Reactのアイコンで視認性向上
- **レスポンシブ**: 横スクロール対応で小画面でも使いやすい

## 🛠️ 使用技術

- **Next.js 15**: App Router
- **TypeScript**: 型安全性
- **Tailwind CSS**: スタイリング
- **AWS Amplify**: Cognito認証
- **React Hot Toast**: 通知表示
- **TanStack Query**: データフェッチング・キャッシング（Phase 3）
- **Recharts**: グラフ表示（Phase 3）
- **React Day Picker**: 日付範囲選択（Phase 3）
- **date-fns**: 日付操作（Phase 3）
- **Lucide React**: アイコンライブラリ

## 📦 新しい依存関係（Phase 3）

```json
{
  "@tanstack/react-query": "^5.90.2",  // データフェッチング・キャッシング
  "recharts": "^3.2.1",                 // グラフ表示
  "date-fns": "^4.1.0",                 // 日付操作
  "react-day-picker": "^9.4.4"          // 日付選択UI
}
```

## 🎯 次のステップ

- [ ] 組織管理ページ (`/admin/organizations`) の実装
- [ ] 請求情報ページ (`/billing`)
- [ ] ユーザー管理ページ（代理店管理者向け）
- [ ] 動画編集機能（タイトル・説明の変更）
- [ ] 一括動画削除機能

---

**作成日**: 2025年10月7日  
**最終更新**: 2025年10月8日（Phase 3実装完了）  
**バージョン**: 1.1.0
