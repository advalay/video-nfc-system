# リリース最終チェックリスト

作成日: 2025-01-02
**リリース予定日**: 即座に可能

---

## ✅ 完了済み項目

- [x] 動画アップロードURL修正（本番URL）
- [x] 動画一覧表示改善（タイトル + ファイル名）
- [x] 動画IDモーダル表示
- [x] システム管理者の組織統計API呼び出し修正
- [x] 販売店作成時のメール重複チェック実装
- [x] 動画削除機能のアクセス権限修正（組織管理者対応）
- [x] 動画削除時間制限の変更（48時間 → 24時間）
- [x] S3アップロード機能の修正（Pre-signed POST実装）
- [x] 動画削除後の表示改善（24時間制限）
- [x] 組織管理の孤児データ削除

---

## 🔥 必須テスト項目（30分）

### 1. 動画アップロード機能 ✅
**テスト環境**: https://main.d3vnoskfyyh2d2.amplifyapp.com

- [x] 動画アップロード成功
- [x] アップロード完了後のURLが正しい
- [x] QRコードが正しく生成される
- [x] 動画が正常に再生できる

**テストアカウント**:
```
メール: kimura@example.com
パスワード: （最新のパスワード）
```

### 2. 全ユーザーロール動作確認

#### システム管理者
```
メール: system-admin@example.com
パスワード: AdminPass123!
```

- [ ] ログイン成功
- [ ] システム統計ページ表示
- [ ] 組織管理ページ表示
- [ ] 動画一覧表示（全動画）
- [ ] 組織作成機能
- [ ] 販売店作成機能

#### 組織管理者
```
メール: orga-admin@example.com
パスワード: （最新のパスワード）
```

- [ ] ログイン成功
- [ ] 左サイドバーに組織名表示
- [ ] 自社管理ページ表示（自分の組織のみ）
- [ ] 販売店統計ページ表示
- [ ] 動画一覧表示（自分の組織のみ）
- [ ] 販売店作成機能
- [ ] アップロードページで制限メッセージ表示

#### 販売店管理者
```
メール: kimura@example.com
パスワード: （最新のパスワード）
```

- [ ] ログイン成功
- [ ] 左サイドバーに店舗名表示
- [ ] 販売店統計ページ表示（自分の店舗のみ）
- [ ] 動画一覧表示（自分の店舗のみ）
- [ ] 動画アップロード機能
- [ ] 動画削除機能（24時間以内）

---

## 📋 中優先度項目（15分）

### 3. デバッグコードの削除（オプション）
- [ ] `console.log`を削除（必要に応じて）
- [ ] 機密情報のログ出力を確認
- [ ] ビルドテスト（`npm run build`）

**ファイル**:
- `hooks/useUpload.ts`
- `app/shop/stats/page.tsx`
- `app/admin/organizations/page.tsx`
- `hooks/useAuth.ts`
- `hooks/useOrganizationStats.ts`
- `app/login/page.tsx`

### 4. パスワードリセット機能テスト
- [ ] 組織管理者で販売店のパスワードリセット実行
- [ ] リセットメールが送信される
- [ ] パスワードリセットが機能する

### 5. エラーハンドリング確認
- [ ] ネットワークエラー時の表示確認
- [ ] 認証エラー時のリダイレクト確認
- [ ] 無効なファイル形式でのエラー表示確認

---

## 🔒 セキュリティ確認（10分）

### 6. 基本セキュリティチェック
- [ ] HTTPS通信確認
- [ ] 認証・認可が正しく機能
- [ ] S3バケットのパブリックアクセスBLOCK_ALL
- [ ] CORS設定確認（現在`*`、リリース後制限推奨）

### 7. データ整合性確認
- [ ] Cognito User Poolのユーザー数確認（6件）
- [ ] DynamoDBのデータ整合性確認
- [ ] 組織と販売店の関連が正しいか

---

## 📊 パフォーマンス確認（5分）

### 8. レスポンス時間
- [ ] ダッシュボード読み込み（目標: <3秒）
- [ ] 動画一覧読み込み（目標: <3秒）
- [ ] 統計ページ読み込み（目標: <3秒）

---

## 🚀 デプロイメント確認（5分）

### 9. 最終デプロイメント確認
- [ ] Amplifyビルド成功（最新）
- [ ] Lambda関数が正しくデプロイ（23個）
- [ ] API Gatewayエンドポイント正常
- [ ] CloudWatch Logsにエラーなし

**コマンド**:
```bash
# Amplifyステータス確認
aws amplify get-app --app-id d3vnoskfyyh2d2 --region ap-northeast-1

# Lambda関数数確認
aws lambda list-functions --region ap-northeast-1 | grep video-nfc-api | wc -l
```

---

## ✅ リリース判定基準

### Go判定（リリース可能）✅
以下の全項目が完了していること:

1. ✅ 動画アップロード機能が正常動作
2. ✅ 動画アップロード完了後のURLが正しい
3. ✅ 全ユーザーロールで正常ログイン可能
4. ✅ 主要機能が正常動作
5. ✅ 重大なセキュリティ問題なし
6. ✅ Amplifyビルド成功

### No-Go判定（リリース延期）
以下のいずれかが発生した場合:

1. ❌ 動画アップロードが動作しない
2. ❌ 認証エラーでログインできない
3. ❌ データ破損や不整合が発生
4. ❌ 重大なセキュリティ脆弱性発見
5. ❌ パフォーマンスが著しく悪い（ページ読み込み >10秒）

---

## 📝 チェックリスト記入欄

### テスト実施記録
```
実施日時: ___________
実施者: ___________

必須テスト項目:
- [ ] 動画アップロード機能
- [ ] システム管理者ログイン
- [ ] 組織管理者ログイン
- [ ] 販売店管理者ログイン

発見された問題:
1. 
2. 

リリース判定: [ ] Go [ ] No-Go

判定理由:
```
---

## 🚨 緊急時のロールバック手順

### 1. Amplifyフロントエンド
```bash
aws amplify get-app --app-id d3vnoskfyyh2d2 --region ap-northeast-1
# 前回のデプロイに戻す（Amplify Console）
```

### 2. Lambda関数
```bash
aws lambda list-versions-by-function --function-name <function-name> --region ap-northeast-1
# 前回のバージョンに戻す（AWS Console）
```

### 3. DynamoDBデータ
- ポイントインタイムリカバリ（最大35日前まで）

### 4. S3データ
- バージョニングで以前のバージョンに戻す

---

## 📚 参考ドキュメント

- [RELEASE_PLAN.md](./RELEASE_PLAN.md) - 詳細な作業計画
- [RELEASE_READINESS_CHECK.md](./RELEASE_READINESS_CHECK.md) - 懸念点と修正計画
- [UPLOAD_URL_FIX_SUMMARY.md](./UPLOAD_URL_FIX_SUMMARY.md) - URL修正詳細
- [S3_UPLOAD_FIX_REPORT.md](../video-nfc-infrastructure/S3_UPLOAD_FIX_REPORT.md) - S3アップロード修正
- [VIDEO_DELETE_FIX.md](./VIDEO_DELETE_FIX.md) - 動画削除修正
- [TEST_ACCOUNTS.md](./TEST_ACCOUNTS.md) - テストアカウント情報

---

## 🎯 リリース後の確認項目（24時間以内）

- [ ] CloudWatch Logsでエラーログを監視
- [ ] DynamoDBのデータ整合性を確認
- [ ] S3バケットの容量を確認
- [ ] ユーザーからの問い合わせ対応
- [ ] パフォーマンスメトリクスの確認

---

**最終更新**: 2025-01-02  
**次回更新予定**: リリース後
