# Googleフォーム自動登録フロー - ステップバイステップガイド

## 📋 概要

このガイドでは、GoogleフォームからAdvalayシステムへの自動店舗登録フローを実際にセットアップする手順を説明します。

## 🚀 セットアップ手順

### **ステップ1: Googleフォームの作成**

1. **Googleフォームにアクセス**
   - ブラウザで https://forms.google.com を開く
   - 「空白のフォーム」を選択

2. **フォームの基本設定**
   ```
   タイトル: Advalay店舗登録フォーム
   説明: 動画アップロードサービス「Advalay」への店舗登録を行います。
         入力いただいた情報は店舗アカウントの作成に使用されます。
   ```

3. **質問項目を追加（以下の順番で）**

   **質問1: 企業名**
   - 質問タイプ: 短答式テキスト
   - 質問: `企業名`
   - 説明: `会社名または法人名を入力してください`
   - 必須: ✅ オン

   **質問2: 店舗名**
   - 質問タイプ: 短答式テキスト
   - 質問: `店舗名`
   - 説明: `店舗名または事業所名を入力してください`
   - 必須: ✅ オン

   **質問3: 担当者名**
   - 質問タイプ: 短答式テキスト
   - 質問: `担当者名`
   - 説明: `担当者様のお名前を入力してください`
   - 必須: ✅ オン

   **質問4: 担当者メールアドレス**
   - 質問タイプ: 短答式テキスト
   - 質問: `担当者メールアドレス`
   - 説明: `連絡先のメールアドレスを入力してください`
   - 必須: ✅ オン

   **質問5: YouTubeチャンネル名（オプション）**
   - 質問タイプ: 短答式テキスト
   - 質問: `YouTubeチャンネル名`
   - 説明: `動画をアップロードするYouTubeチャンネル名（任意）`
   - 必須: ❌ オフ

4. **フォーム設定**
   - 設定タブ → 「新しい回答が送信されたときにメール通知を受け取る」をオン
   - 回答 → 「回答を1回だけ送信」をオン

### **ステップ2: フォームIDの取得**

1. **フォームのURLをコピー**
   ```
   例: https://docs.google.com/forms/d/1ABC123DEF456GHI789JKL/edit
   ```

2. **フォームIDを抽出**
   ```
   フォームID: 1ABC123DEF456GHI789JKL
   ```
   ↑ この部分をコピーして保存

### **ステップ3: Google Apps Scriptの設定**

1. **新しいプロジェクトを作成**
   - https://script.google.com にアクセス
   - 「新しいプロジェクト」をクリック

2. **スクリプトコードを設定**
   - `google-apps-script-configured.js` の内容をコピー＆ペースト

3. **設定値を更新**
   ```javascript
   const CONFIG = {
     API_BASE_URL: 'http://localhost:4000',
     FORM_ID: '1ABC123DEF456GHI789JKL',  // ← ステップ2で取得したID
     // その他はそのまま
   };
   ```

### **ステップ4: 初回セットアップ**

1. **設定検証**
   ```javascript
   validateConfig();
   ```

2. **セットアップ実行**
   ```javascript
   setup();
   ```

3. **テスト実行**
   ```javascript
   testFormSubmission();
   ```

### **ステップ5: 実際のテスト**

1. **Googleフォームで回答送信**
   ```
   企業名: テスト企業株式会社
   店舗名: テスト店舗
   担当者名: テスト太郎
   担当者メールアドレス: test@example.com
   YouTubeチャンネル名: テストチャンネル
   ```

2. **ログの確認**
   - Google Apps Scriptのログで自動処理を確認
   - Advalay管理ダッシュボードで新しい店舗を確認

## 🔧 トラブルシューティング

### **よくある問題と解決方法**

1. **トリガーが動作しない**
   ```javascript
   // 解決方法
   setup(); // 再実行
   ```

2. **API送信エラー**
   ```javascript
   // 解決方法
   testFormSubmission(); // テストで確認
   ```

3. **フォームデータが正しく送信されない**
   - フォームの質問名が正確か確認
   - `getFormHeaders()` でヘッダーを確認

### **ログの確認方法**

1. **Google Apps Scriptのログ**
   - Apps Scriptエディタ → 「実行」→ 「ログを表示」

2. **Advalay APIのログ**
   - サーバーログでWebhook受信を確認

## 📊 動作確認

### **成功時の流れ**

1. **フォーム送信** → **Google Apps Script実行** → **API送信** → **店舗作成** → **通知送信**

2. **確認ポイント**
   - Google Apps Scriptログで「店舗作成成功」を確認
   - Advalay管理ダッシュボードで新しい店舗を確認
   - ストアトークンが正常に生成されているか確認

### **エラー時の対応**

1. **フォームデータエラー**
   - 必須フィールドが入力されているか確認
   - メールアドレス形式が正しいか確認

2. **API送信エラー**
   - APIサーバーが起動しているか確認
   - ネットワーク接続を確認

## 🎯 次のステップ

### **本番環境への移行**

1. **設定値の更新**
   ```javascript
   const CONFIG = {
     API_BASE_URL: 'https://your-domain.com', // 本番URL
     WEBHOOK_TOKEN: 'strong-production-token', // 強力なトークン
   };
   ```

2. **セキュリティ強化**
   - Webhookトークンの設定
   - IP制限の追加（必要に応じて）

3. **監視設定**
   - ログ監視の設定
   - エラー通知の設定

## 📝 使用可能な関数

```javascript
// セットアップ
setup();

// テスト
testFormSubmission();

// 設定確認
showConfig();
validateConfig();

// ヘルプ
help();
```

これで、GoogleフォームからAdvalayシステムへの自動店舗登録フローが完全に動作します！
